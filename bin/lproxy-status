#/bin/bash

BEXIST=`docker ps -a| grep ssllibev|wc -l`
if [ $BEXIST -eq 0 ]; then
	echo "Local proxy not found."
	exit
else
	echo "Local proxy started."
	echo
fi

HTTPPORT=`docker exec -it ssllibev cat /root/polipo/config|grep proxyPort|cut -d= -f2|sed 's/\r//g'`
SOCKSPORT=`docker exec -it ssllibev cat /root/polipo/config|grep socksParentProxy|cut -d: -f2|sed 's/\r//g'`
DNSPORT=`docker exec -it ssllibev cat /etc/dnscrypt-proxy/dnscrypt-proxy.toml|grep listen_addresses|cut -d"'" -f2|cut -d: -f2|sed 's/\r//g'`

echo "Checking local HTTP proxy on TCP:$HTTPPORT ..."
echo "curl -x http://127.0.0.1:$HTTPPORT http://ifconfig.co"
docker exec -it ssllibev curl -x http://127.0.0.1:$HTTPPORT http://ifconfig.co
echo

echo "Checking local SOCKS5 proxy on TCP:$SOCKSPORT ..."
echo "curl -x socks5://127.0.0.1:$SOCKSPORT http://ifconfig.co"
docker exec -it ssllibev curl -x socks5://127.0.0.1:$SOCKSPORT http://ifconfig.co
echo

echo "Checking local DNS proxy on UDP:$DNSPORT ..."
echo "dig +short @127.0.0.1 -p $DNSPORT twitter.com"
docker exec -it ssllibev dig +short @127.0.0.1 -p $DNSPORT twitter.com
echo

echo "Done."
