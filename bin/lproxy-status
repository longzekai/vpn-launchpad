#/bin/bash

BEXIST=`docker ps| grep ssllibev|wc -l`
if [ $BEXIST -eq 0 ]; then
	echo "Local proxy is not running."
	exit
else
	echo "Local proxy started."
	echo
fi

HTTPPORT=`docker inspect -f '{{(index (index .NetworkSettings.Ports "1080/tcp") 0).HostPort}}' ssllibev`
SOCKSPORT=`docker inspect -f '{{(index (index .NetworkSettings.Ports "8123/tcp") 0).HostPort}}' ssllibev`
DNSPORT=`docker inspect -f '{{(index (index .NetworkSettings.Ports "53/udp") 0).HostPort}}' ssllibev`

echo "Checking local HTTP proxy on TCP:$HTTPPORT ..."
echo "curl -x http://127.0.0.1:$HTTPPORT http://ifconfig.co"
docker exec -it ssllibev curl -x http://127.0.0.1:$HTTPPORT http://ifconfig.co
echo

echo "Checking local SOCKS5 proxy on TCP:$SOCKSPORT ..."
echo "curl -x socks5://127.0.0.1:$SOCKSPORT http://ifconfig.co"
docker exec -it ssllibev curl -x socks5://127.0.0.1:$SOCKSPORT http://ifconfig.co
echo

echo "Checking local DNS proxy on UDP:$DNSPORT ..."
echo "dig +short @127.0.0.1 -p $DNSPORT twitter.com"
docker exec -it ssllibev dig +short @127.0.0.1 -p $DNSPORT twitter.com
echo

echo "Done."
