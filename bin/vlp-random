#!/bin/bash

DIR=`dirname $0`
VLPDIR="$(cd $DIR; cd ..; pwd)"
VLPHOME="$HOME/.vpn-launchpad"
UBUNTUVER=bionic

while [[ $# > 0 ]]; do
	case $1 in
		-y|--yes)
			OVW=1
			shift
			;;
		*)
			OVW=0
			shift
			;;
	esac
done

if [[ "$OVW" != 1 ]]; then
	read -p 'Randomise VPN password?(Y/n) ' choice
	if [ "${choice:0:1}" = "n" ] || [ "${choice:0:1}" = "N" ]; then
		exit
	fi
fi

echo "Randomising VPN password..."
echo

sed -i "s/PSK=.*/PSK=`pwgen -cB1`/g" $VLPDIR/server-softether/softether.env
sed -i "s/USERS=.*/USERS=user0:`pwgen -cB1`;user1:`pwgen -cB1`;/g" $VLPDIR/server-softether/softether.env
sed -i "s/SPW=.*/SPW=`pwgen -cB1`/g" $VLPDIR/server-softether/softether.env
sed -i "s/HPW=.*/HPW=`pwgen -cB1`/g" $VLPDIR/server-softether/softether.env
cat $VLPDIR/server-softether/softether.env
echo

sed -i "s/SSTCPPORT=.*/SSTCPPORT=`echo \"50000+$RANDOM%10000\"|bc`/g" $VLPDIR/server-ssserver/ssserver.env
sed -i "s/SSPASS=.*/SSPASS=`pwgen -cB1`/g" $VLPDIR/server-ssserver/ssserver.env
cat $VLPDIR/server-ssserver/ssserver.env
echo

echo "Done."
