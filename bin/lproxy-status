#/bin/bash

CTNNAME="proxy-ssllibev"
DKVER=`docker -v 2>/dev/null|awk '{print $3}'`

if [ "$DKVER" = "" ]; then
	echo "Docker executable not found."
	echo "Abort."
	exit 255
fi

BEXIST=`docker ps| grep $CTNNAME|wc -l`

if [ $BEXIST -eq 0 ]; then
	echo "Local proxy is not running."
	exit
else
	echo "Local proxy started."
	echo
fi

HTTPPORT=`docker inspect -f '{{(index (index .NetworkSettings.Ports "8123/tcp") 0).HostPort}}' $CTNNAME`
SOCKSPORT=`docker inspect -f '{{(index (index .NetworkSettings.Ports "1080/tcp") 0).HostPort}}' $CTNNAME`
DNSPORT=`docker inspect -f '{{(index (index .NetworkSettings.Ports "53/udp") 0).HostPort}}' $CTNNAME`

echo "Checking local HTTP proxy on TCP:$HTTPPORT ..."
echo "curl -x http://127.0.0.1:$HTTPPORT http://ifconfig.co"
curl -x http://127.0.0.1:$HTTPPORT http://ifconfig.co
echo

echo "Checking local SOCKS5 proxy on TCP:$SOCKSPORT ..."
echo "curl -x socks5://127.0.0.1:$SOCKSPORT http://ifconfig.co"
curl -x socks5://127.0.0.1:$SOCKSPORT http://ifconfig.co
echo

echo "Checking local DNS proxy on UDP:$DNSPORT ..."
echo "dig +short @127.0.0.1 -p $DNSPORT twitter.com"
dig +short @127.0.0.1 -p $DNSPORT twitter.com
echo

echo "Done."
